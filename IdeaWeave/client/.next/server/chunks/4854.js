"use strict";exports.id=4854,exports.ids=[4854],exports.modules={4854:(e,t,l)=>{l.a(e,async(e,r)=>{try{l.d(t,{Z:()=>X});var o=l(997),s=l(6689);l(1791);var a=l(9648),i=l(5417),n=l.n(i),c=l(3526),d=l.n(c),m=l(7050),p=l.n(m),h=l(8518),u=l.n(h),x=l(675),g=l.n(x),y=l(3800),v=l.n(y),j=l(6418),f=l.n(j),S=l(2317),C=l.n(S),$=l(8633),w=l.n($),b=l(6216),k=l.n(b),I=l(3166),N=l.n(I),M=l(5152),q=l.n(M),z=l(6201),O=l(1163),B=l(2540),P=l.n(B),T=l(1796),E=l.n(T),J=l(2981),_=l.n(J),A=l(3911),D=l.n(A);l(3789);var L=l(148),V=l(4212),R=l(8214),H=e([a,z,L]);[a,z,L]=H.then?(await H)():H;let U=q()(()=>Promise.resolve().then(l.t.bind(l,305,23)),{loadableGenerated:{modules:["..\\components\\posts\\EditDraftComponent.js -> react-quill"]},ssr:!1,loading:()=>o.jsx("p",{children:"Loading ..."})}),{Content:Z}=n(),{Option:G}=d(),{Panel:W}=w(),{TabPane:Y}=k(),F={toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["clean"]]},K=["font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","script","color","background"],Q={height:"500px",overflowY:"auto",padding:"20px"},X=function({page:e="admin"}){let[t,l]=(0,s.useState)({}),[r,i]=(0,s.useState)(""),[n,c]=(0,s.useState)([]),[m,h]=(0,s.useState)(""),[x,y]=(0,s.useState)({}),[j,S]=(0,s.useState)(!1),[$,b]=(0,s.useState)(!0),I=(0,O.useRouter)(),[M,q]=(0,s.useContext)(V.Y),[B,T]=(0,s.useState)(0),{Step:J}=N(),[A,H]=(0,s.useState)([]),[Z,X]=(0,s.useState)(!1),[ee,et]=(0,s.useState)(""),[el,er]=(0,s.useState)([]),[eo,es]=(0,s.useState)([]);(0,s.useEffect)(()=>{ea(),ei()},[]),(0,s.useEffect)(()=>{ei()},[I?.query?.slug]);let ea=async()=>{try{let{data:e}=await a.default.get("/category");c(e)}catch(e){console.log(e)}},ei=async()=>{try{let{data:e}=await a.default.get(`/draft/${I.query.slug}`);i(e.post.title),l(e.post.content),y(e.post.coverImage),h(e.post._id);let t=e.post.volumes.map(e=>({volume:e.volume,chapters:e.chapters.map(e=>({name:e.name||`Chapter ${chapterIndex+1}`,content:e.content}))}));H(t);let r=[];e.post.categories.map(e=>r.push(e.name)),er(r),b(!1)}catch(e){console.log(e),b(!1)}},en=async()=>{try{b(!0);let l=A.filter(e=>e.volume&&e.chapters.length>=1).map((e,l)=>`${e.volume}: ${e.chapters.map((e,r)=>`Chapter ${e.chapter||"1"}: ${e.name} - ${t[`${l}-${r}`]?.content||ec(l,r)||""}`).join(", ")}`).join("; "),o=`<div style="font-size: 1.2rem; line-height: 1.6">${l}</div>`,s=el.length>0?el:eo,i={title:r,content:o,categories:s,coverImage:M?.selected?._id?M?.selected?._id:x?._id?x._id:void 0,volumes:A.map((e,l)=>({volume:e.volume,chapters:e.chapters.map((e,r)=>{let o=`${l}-${r}`,s=t[o];return{chapter:e.chapter||"1",name:e.name||"Untitled",content:s?.content!==void 0?s.content:e.content}})}))},{data:n}=await a.default.put(`/edit-draft/${m}`,i);n?.error?(z.toast.error(n?.error),b(!1)):(localStorage.removeItem("draft-edit-title"),localStorage.removeItem("draft-edit-volumes"),Object.keys(t).forEach(e=>{let t=`draft-edit-volumes-${e}`;localStorage.removeItem(t)}),localStorage.removeItem("draft-edit-image"),q({...M,selected:null}),I.push(`/${e}/drafts`),z.toast.success("Draft updated successfully"))}catch(e){console.error(e),z.toast.error("Draft update failed. Try again."),b(!1)}},ec=(e,t)=>{let l=`${e}-${t}`,r=`draft-edit-volumes-${l}`,o=JSON.parse(localStorage.getItem(r));return o?.content||""},ed=()=>{if(0===B)localStorage.setItem("draft-edit-title",JSON.stringify(r));else if(1===B){let e=JSON.parse(localStorage.getItem("draft-edit-volumes"))||[],t=JSON.parse(localStorage.getItem("draft-edit-image"))||{},l=A.some((t,l)=>{let r=e[l]||{};return t.volume!==r.volume||t.chapters.some((e,t)=>{let l=r.chapters?.[t]||{};return e.name!==l.name||e.content!==l.content})});if(l){let e=A.map(e=>({volume:e.volume,chapters:e.chapters.map(e=>({chapter:e.chapter||"1",name:e.name||"Untitled",content:e.content||""}))}));localStorage.setItem("draft-edit-volumes",JSON.stringify(e)),localStorage.setItem("draft-edit-image",JSON.stringify(M?.selected))}else localStorage.setItem("draft-edit-volumes",JSON.stringify(e)),localStorage.setItem("draft-edit-image",JSON.stringify(t))}T(B+1)},em=()=>{T(B-1)},ep=(e,t)=>{let r=[...A];r[e].chapters.splice(t,1),r[e].chapters.forEach((e,t)=>{e.chapter=t+1,e.name=`Chapter ${e.chapter}`});let o=`${e}-${t}`,s=`draft-edit-volumes-${o}`;localStorage.removeItem(s),H(r),l(e=>{let{[o]:t,...l}=e;return l})},eh=e=>{let t=[...A],r=t.splice(e,1)[0],o=`volume-${e}`;localStorage.removeItem(o),r.chapters.forEach((t,l)=>{let r=`${e}-${l}`,o=`draft-edit-volumes-${r}`;localStorage.removeItem(o)}),H(t),l(t=>{let l=Object.keys(t).filter(t=>t.startsWith(`${e}-`)),{[o]:r,...s}=t;return l.reduce((e,l)=>{let r=`draft-edit-volumes-${l}`;return localStorage.removeItem(r),{...e,[l]:t[l]}},s)})};return(0,o.jsxs)(o.Fragment,{children:[o.jsx(p(),{justify:"center",style:{paddingLeft:50,paddingTop:"50px",paddingRight:50},children:o.jsx(u(),{span:18,children:(0,o.jsxs)(C(),{style:{padding:"20px",marginBottom:"20px"},children:[(0,o.jsxs)(N(),{current:B,style:{marginBottom:"20px"},children:[o.jsx(J,{title:"Book Info"}),o.jsx(J,{title:"Volumes and Chapters"}),o.jsx(J,{title:"Review and Publish"})]}),0===B&&(0,o.jsxs)(C(),{children:[o.jsx("h1",{children:"Create a new Book"}),o.jsx(g(),{value:r,size:"large",placeholder:"Give your post a title",onChange:e=>{i(e.target.value)}}),o.jsx("br",{}),o.jsx("br",{}),(0,o.jsxs)(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},onClick:()=>q({...M,showMediaModal:!0}),children:[o.jsx(P(),{})," Cover Image"]}),M?.selected?(0,o.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[o.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:M?.selected?.url,alt:"Image"}),o.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,o.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[o.jsx(E(),{style:{fontSize:"25px",color:"white"}}),o.jsx("br",{}),"Click to Preview"]})})]}):x?.url?(0,o.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[o.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:x?.url,alt:"Image"}),o.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,o.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[o.jsx(E(),{style:{fontSize:"25px",color:"white"}}),o.jsx("br",{}),"Click to Preview"]})})]}):"",o.jsx("br",{}),o.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:ed,children:"Next"})]}),1===B&&(0,o.jsxs)(C(),{style:{marginBottom:"20px"},children:[o.jsx("h1",{children:"Volumes and Chapters"}),o.jsx(w(),{accordion:!0,children:A.map((e,r)=>(0,o.jsxs)(W,{header:`Volume ${r+1}`,children:[o.jsx(g(),{value:e.volume,size:"large",placeholder:`Volume ${r+1}`,onChange:e=>{let t=[...A];t[r].volume=e.target.value,H(t)}}),o.jsx("div",{style:{marginBottom:"10px"}}),o.jsx(k(),{tabPosition:"left",children:e.chapters.map((e,s)=>(0,o.jsxs)(Y,{tab:`Chapter ${s+1}`,children:[(0,o.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,o.jsxs)(v(),{style:{marginRight:"8px"},type:"danger",onClick:()=>ep(r,s),children:["Remove Chapter ",s+1]}),o.jsx("span",{children:`Chapter ${s+1}: ${e.name}`})]}),o.jsx(g(),{value:e.name,placeholder:`Chapter ${s+1} Name`,onChange:e=>{let t=[...A];t[r].chapters[s].name=e.target.value,H(t)}}),o.jsx("div",{style:Q,children:o.jsx(U,{modules:F,formats:K,placeholder:"Compose here...",value:e.content,onChange:(o,a,i,n)=>{let c=[...A];c[r].chapters[s].content=o,H(c);let d=`${r}-${s}`;l({...t,[d]:{content:o,name:`Chapter ${s+1}: ${e.name}`}});let m=`draft-edit-volumes-${d}`;localStorage.setItem(m,JSON.stringify({content:o,name:`Chapter ${s+1}: ${e.name}`}))},theme:"snow",style:{height:"400px",marginTop:"10px"}})})]},`chapter-${r}-${s}`))}),o.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:o.jsx(_(),{}),onClick:()=>{let e=[...A],t=e[r].chapters.length-1,l=t>=0?Math.max(...e[r].chapters.map(e=>e.chapter))+1:1;e[r].chapters.push({name:`Chapter ${l}`,chapter:l,content:""}),H(e)},children:"Add Chapter"}),(0,o.jsxs)(v(),{style:{margin:"10px 0px 20px",width:"100%"},onClick:()=>eh(r),children:["Remove Volume ",r+1]})]},`volume-${r}`))}),o.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:o.jsx(_(),{}),onClick:()=>{H([...A,{volume:"",chapters:[{chapter:"",content:""}]}])},children:"Add Volume"}),(0,o.jsxs)(p(),{justify:"space-between",style:{marginTop:"20px"},children:[o.jsx(u(),{children:o.jsx(v(),{type:"primary",onClick:em,children:"Previous"})}),o.jsx(u(),{children:o.jsx(v(),{type:"primary",onClick:ed,children:"Next"})})]})]}),2===B&&(0,o.jsxs)(C(),{style:{maxWidth:"800px",margin:"auto",marginTop:"20px"},children:[o.jsx("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Review and Publish"}),M?.selected?(0,o.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[o.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:M?.selected?.url,alt:"Image"}),o.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,o.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[o.jsx(E(),{style:{fontSize:"25px",color:"white"}}),o.jsx("br",{}),"Click to Preview"]})})]}):x?.url?(0,o.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[o.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:x?.url,alt:"Image"}),o.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,o.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[o.jsx(E(),{style:{fontSize:"25px",color:"white"}}),o.jsx("br",{}),"Click to Preview"]})})]}):"",o.jsx("h2",{children:"Book Title:"}),o.jsx("p",{children:r}),o.jsx("h2",{children:"Volumes and Chapters:"}),o.jsx(k(),{defaultActiveKey:"0",type:"card",style:{marginBottom:"20px"},children:A.map((e,l)=>o.jsx(Y,{tab:`Volume ${l+1}: ${e.volume}`,children:o.jsx(k(),{type:"card",children:e.chapters.map((e,r)=>{let s=`${l}-${r}`,a=t[s]?.content||"",i=e.content||"";return o.jsx(Y,{tab:`Chapter ${r+1}: ${e.name}`,children:o.jsx("div",{dangerouslySetInnerHTML:{__html:i!==a?i:a},style:{fontSize:"1.2rem",lineHeight:"1.6",padding:"20px"}})},s)})})},l.toString()))}),o.jsx("h2",{children:"Categories:"}),o.jsx("h4",{children:"Select categories for your post:"}),o.jsx(d(),{mode:"multiple",allowClear:!0,placeholder:"Select categories",style:{width:"100%"},value:el,onChange:e=>er(e),children:n.map(e=>o.jsx(G,{children:e.name},e.name))}),o.jsx("div",{style:{marginBottom:"10px"}}),o.jsx(v(),{style:{width:"100%",marginBottom:"10px"},type:"primary",loading:$,icon:o.jsx(D(),{}),onClick:()=>{if(0===el.length){z.toast.error("Please choose at least one category before publishing.");return}en()},children:"Save to Draft"}),o.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:em,children:"Previous"})]})]})})}),o.jsx(R.Z,{visible:Z,imageUrl:ee,onClose:()=>X(!1)}),(0,o.jsxs)(f(),{title:"Preview",centered:!0,visible:j,onOk:()=>S(!1),onCancel:()=>S(!1),width:720,footer:null,children:[o.jsx("h1",{style:{fontSize:"1.2rem",lineHeight:"1.6"},children:r}),o.jsx("div",{dangerouslySetInnerHTML:{__html:t},style:{fontSize:"1.2rem",lineHeight:"1.6"}})]}),o.jsx(f(),{visible:M.showMediaModal,title:"Media",onOk:()=>S(!1),onCancel:()=>S(!1),width:720,footer:null,children:o.jsx(L.Z,{style:{fontSize:"1.2rem",lineHeight:"1.6"}})})]})};r()}catch(e){r(e)}})}};