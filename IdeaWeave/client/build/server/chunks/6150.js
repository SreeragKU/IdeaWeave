"use strict";exports.id=6150,exports.ids=[6150],exports.modules={6150:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{Z:()=>X});var o=r(997),l=r(6689);r(1791);var s=r(9648),n=r(5417),i=r.n(n),c=r(3526),p=r.n(c),h=r(7050),m=r.n(h),d=r(8518),u=r.n(d),g=r(675),x=r.n(g),y=r(3800),v=r.n(y),j=r(6418),f=r.n(j),S=r(2317),$=r.n(S),C=r(8633),b=r.n(C),w=r(6216),I=r.n(w),k=r(3166),N=r.n(k),P=r(5152),O=r.n(P),B=r(6201),M=r(1163),z=r(2540),T=r.n(z),J=r(1796),R=r.n(J),V=r(2981),E=r.n(V),H=r(3911),_=r.n(H),q=r(148),A=r(4212),L=r(8214),Z=e([s,B,q]);[s,B,q]=Z.then?(await Z)():Z;let D=O()(()=>Promise.resolve().then(r.t.bind(r,305,23)),{loadableGenerated:{modules:["..\\components\\posts\\NewPostComponent.js -> react-quill"]},ssr:!1,loading:()=>o.jsx("p",{children:"Loading ..."})}),{Content:F}=i(),{Option:G}=p(),{Panel:U}=b(),{TabPane:W}=I(),Y={toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["clean"]]},K=["font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","script","color","background"],Q={height:"500px",overflowY:"auto",padding:"20px"},X=function({page:e="admin"}){let[t,r]=(0,l.useState)(0),[a,n]=(0,l.useState)({}),[i,c]=(0,l.useState)([]),[h,d]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),j=(0,M.useRouter)(),{Step:S}=N(),[C,w]=(0,l.useContext)(A.Y),[k,P]=(0,l.useState)(!1),[O,z]=(0,l.useState)(""),[J,V]=(0,l.useState)([]),[H,Z]=(0,l.useState)(""),[F,X]=(0,l.useState)([{volume:"",chapters:[{chapter:"1",name:"",content:""}]}]),ee=()=>{let e=JSON.parse(localStorage.getItem("post-volumes"))||[],t=e.reduce((t,r,a)=>{let o=r.chapters.reduce((t,r,o)=>{let l=`${a}-${o}`,s=`post-chapter-${l}`,n=JSON.parse(localStorage.getItem(s)),i=[...e];return i[a].chapters[o].content=n&&n.content||"",localStorage.setItem("post-volumes",JSON.stringify(i)),{...t,[l]:n&&n.content||""}},{});return{...t,...o}},{});n(t)},et=()=>{if(0===t){if(!H||!C?.selected){B.toast.error("Please enter a title and select a cover image.");return}localStorage.setItem("post-title",JSON.stringify(H))}else if(1===t){let e=F.filter(e=>!e.volume||e.chapters.length<1||!e.chapters.every(e=>e.name&&e.content));if(e.length>0){B.toast.error("Please enter valid volume names and ensure each chapter has a name and content.");return}let t=F.map(e=>({volume:e.volume,chapters:e.chapters.map(e=>({chapter:e.chapter||"1",name:e.name||"Untitled",content:e.content||""}))}));localStorage.setItem("post-volumes",JSON.stringify(t)),localStorage.setItem("post-image",JSON.stringify(C?.selected))}else if(2===t&&0===en.length){B.toast.error("Please choose at least one category before publishing.");return}r(t+1)},er=()=>{r(t-1)};(0,l.useEffect)(()=>{ea(),ee()},[]),(0,l.useEffect)(()=>{let e=JSON.parse(localStorage.getItem("post-image"));e&&w({...C,selected:e})},[]);let ea=async()=>{try{let{data:e}=await s.default.get("/category");c(e)}catch(e){console.log(e)}},eo=(e,t)=>{let r=[...F];r[e].chapters.splice(t,1),r[e].chapters.forEach((e,t)=>{e.chapter=t+1,e.name=`Chapter ${e.chapter}`});let a=`${e}-${t}`,o=`post-chapter-${a}`;localStorage.removeItem(o),X(r),n(e=>{let{[a]:t,...r}=e;return r})},el=(e,t)=>{let r=`${e}-${t}`,a=`post-chapter-${r}`,o=JSON.parse(localStorage.getItem(a));return o?.content||""},es=e=>{let t=[...F],r=t.splice(e,1)[0],a=`volume-${e}`;localStorage.removeItem(a),r.chapters.forEach((t,r)=>{let a=`${e}-${r}`,o=`post-chapter-${a}`;localStorage.removeItem(o)}),X(t),n(t=>{let r=Object.keys(t).filter(t=>t.startsWith(`${e}-`)),{[a]:o,...l}=t;return r.reduce((e,r)=>{let a=`post-chapter-${r}`;return localStorage.removeItem(a),{...e,[r]:t[r]}},l)})},[en,ei]=(0,l.useState)([]),ec=async()=>{try{y(!0);let t=F.filter(e=>e.volume&&e.chapters.length>=1).map((e,t)=>{let r=e.chapters.map((e,r)=>({chapterNumber:e.chapter,chapterName:e.name,chapterContent:a[`${t}-${r}`]?.content||el(t,r)||""})).filter(e=>""!==e.chapterContent.trim());return{volumeName:e.volume,chapters:r}}),r=`<div style="font-size: 1.2rem; line-height: 1.6">${t}</div>`,o={title:H,content:r,categories:en,coverImage:C?.selected?._id,volumes:F.map((e,t)=>({volume:e.volume,chapters:e.chapters.map((e,r)=>(e.chapter||B.toast.error("Chapter number cannot be empty"),{chapter:e.chapter,name:e.name,content:a[`${t}-${r}`]?.content||el(t,r)||""}))}))},{data:l}=await s.default.post("/create-post",o);l?.error?(B.toast.error(l?.error),y(!1)):(localStorage.removeItem("post-title"),localStorage.removeItem("post-volumes"),Object.keys(a).forEach(e=>{let t=`post-chapter-${e}`;localStorage.removeItem(t)}),localStorage.removeItem("post-image"),w({...C,selected:null}),j.push(`/${e}/posts`),B.toast.success("Post created successfully"))}catch(e){console.error(e),B.toast.error("Post create failed. Try again."),y(!1)}},ep=async()=>{try{y(!0);let t=F.filter(e=>e.volume&&e.chapters.length>=1).map((e,t)=>{let r=e.chapters.map((e,r)=>({chapterNumber:e.chapter,chapterName:e.name,chapterContent:a[`${t}-${r}`]?.content||el(t,r)||""})).filter(e=>""!==e.chapterContent.trim());return{volumeName:e.volume,chapters:r}}),r=`<div style="font-size: 1.2rem; line-height: 1.6">${t}</div>`,o={title:H,content:r,categories:en,coverImage:C?.selected?._id,volumes:F.map((e,t)=>({volume:e.volume,chapters:e.chapters.map((e,r)=>(e.chapter||B.toast.error("Chapter number cannot be empty"),{chapter:e.chapter,name:e.name,content:a[`${t}-${r}`]?.content||el(t,r)||""}))}))},{data:l}=await s.default.post("/create-draft",o);l?.error?(B.toast.error(l?.error),y(!1)):(localStorage.removeItem("post-title"),localStorage.removeItem("post-volumes"),Object.keys(a).forEach(e=>{let t=`post-chapter-${e}`;localStorage.removeItem(t)}),localStorage.removeItem("post-image"),w({...C,selected:null}),j.push(`/${e}/posts/drafts`),B.toast.success("Post created successfully"))}catch(e){console.error(e),B.toast.error("Post create failed. Try again."),y(!1)}};return(0,o.jsxs)(o.Fragment,{children:[o.jsx(m(),{justify:"center",style:{paddingLeft:50,paddingTop:"50px",paddingRight:50},children:o.jsx(u(),{span:18,children:(0,o.jsxs)($(),{style:{padding:"20px",marginBottom:"20px"},children:[(0,o.jsxs)(N(),{current:t,style:{marginBottom:"20px"},children:[o.jsx(S,{title:"Book Info"}),o.jsx(S,{title:"Volumes and Chapters"}),o.jsx(S,{title:"Review and Publish"})]}),0===t&&(0,o.jsxs)($(),{children:[o.jsx("h1",{children:"Create a new Book"}),o.jsx(x(),{value:H,size:"large",placeholder:"Give your post a title",onChange:e=>{Z(e.target.value)}}),o.jsx("br",{}),o.jsx("br",{}),(0,o.jsxs)(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},onClick:()=>w({...C,showMediaModal:!0}),children:[o.jsx(T(),{})," Cover Image"]}),C?.selected&&(0,o.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{C?.selected&&(z(C?.selected?.url),P(!0))},children:[o.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:C?.selected?.url,alt:"Image"}),o.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,o.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[o.jsx(R(),{style:{fontSize:"25px",color:"white"}}),o.jsx("br",{}),"Click to Preview"]})})]}),o.jsx("br",{}),o.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:et,children:"Next"})]}),1===t&&(0,o.jsxs)($(),{style:{marginBottom:"20px"},children:[o.jsx("h1",{children:"Volumes and Chapters"}),o.jsx(b(),{accordion:!0,children:F.map((e,t)=>(0,o.jsxs)(U,{header:`Volume ${t+1}`,children:[o.jsx(x(),{value:e.volume,size:"large",placeholder:`Volume ${t+1}`,onChange:e=>{let r=[...F];r[t].volume=e.target.value,X(r)}}),o.jsx("div",{style:{marginBottom:"10px"}}),o.jsx(I(),{tabPosition:"left",children:e.chapters.map((e,r)=>(0,o.jsxs)(W,{tab:`Chapter ${r+1}`,children:[(0,o.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,o.jsxs)(v(),{style:{marginRight:"8px"},type:"danger",onClick:()=>eo(t,r),children:["Remove Chapter ",r+1]}),o.jsx("span",{children:`Chapter ${r+1}: ${e.name}`})]}),o.jsx(x(),{value:e.name,placeholder:`Chapter ${r+1} Name`,onChange:e=>{let a=[...F];a[t].chapters[r].name=e.target.value,X(a)}}),o.jsx("div",{style:Q,children:o.jsx(D,{modules:Y,formats:K,placeholder:"Compose here...",value:e.content,onChange:(o,l,s,i)=>{let c=[...F];c[t].chapters[r].content=o,X(c);let p=`${t}-${r}`;n({...a,[p]:{content:o,name:`Chapter ${r+1}: ${e.name}`}});let h=`post-chapter-${p}`;localStorage.setItem(h,JSON.stringify({content:o,name:`Chapter ${r+1}: ${e.name}`}))},theme:"snow",style:{height:"400px",marginTop:"10px"}})})]},`chapter-${t}-${r}`))}),o.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:o.jsx(E(),{}),onClick:()=>{let e=[...F],r=e[t].chapters.length-1,a=r>=0?parseInt(e[t].chapters[r].chapter,10)+1:1;e[t].chapters.push({name:`Chapter ${a}`,chapter:a.toString(),content:""}),X(e)},children:"Add Chapter"}),(0,o.jsxs)(v(),{style:{margin:"10px 0px 20px",width:"100%"},onClick:()=>es(t),children:["Remove Volume ",t+1]})]},`volume-${t}`))}),o.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:o.jsx(E(),{}),onClick:()=>{let e=[...F];e.push({volume:"",chapters:[{chapter:"1",name:"Chapter 1",content:""}]}),X(e)},children:"Add Volume"}),(0,o.jsxs)(m(),{justify:"space-between",style:{marginTop:"20px"},children:[o.jsx(u(),{children:o.jsx(v(),{type:"primary",onClick:er,children:"Previous"})}),o.jsx(u(),{children:o.jsx(v(),{type:"primary",onClick:et,children:"Next"})})]})]}),2===t&&(0,o.jsxs)($(),{style:{maxWidth:"800px",margin:"auto",marginTop:"20px"},children:[o.jsx("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Review and Publish"}),C?.selected&&o.jsx("div",{style:{marginBottom:"20px",overflow:"hidden",borderRadius:"8px",maxHeight:"200px",cursor:"pointer"},onClick:()=>{C?.selected&&(z(C?.selected?.url),P(!0))},children:o.jsx("img",{style:{width:"100%",height:"100%",objectFit:"cover"},src:C.selected.url,alt:"Cover Image"})}),o.jsx("h2",{children:"Book Title:"}),o.jsx("p",{children:H}),o.jsx("h2",{children:"Volumes and Chapters:"}),o.jsx(I(),{defaultActiveKey:"0",type:"card",style:{marginBottom:"20px"},children:F.map((e,t)=>o.jsx(W,{tab:`Volume ${t+1}: ${e.volume}`,children:o.jsx(I(),{type:"card",children:e.chapters.map((e,r)=>{let l=`${t}-${r}`,s=a[l]?.content||"",n=e.content||"";return o.jsx(W,{tab:`Chapter ${r+1}: ${e.name}`,children:o.jsx("div",{dangerouslySetInnerHTML:{__html:n!==s?n:s},style:{fontSize:"1.2rem",lineHeight:"1.6",padding:"20px"}})},l)})})},t.toString()))}),o.jsx("h2",{children:"Categories:"}),o.jsx("h4",{children:"Select categories for your post:"}),o.jsx(p(),{mode:"multiple",allowClear:!0,placeholder:"Select categories",style:{width:"100%"},value:en,onChange:e=>ei(e),children:i.map(e=>o.jsx(G,{children:e.name},e.name))}),o.jsx("div",{style:{marginBottom:"10px"}}),o.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"primary",loading:g,onClick:ep,children:"Save to Draft"}),o.jsx(v(),{style:{width:"100%",marginBottom:"10px"},type:"primary",loading:g,icon:o.jsx(_(),{}),onClick:()=>{if(0===en.length){B.toast.error("Please choose at least one category before publishing.");return}ec()},children:"Publish"}),o.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:er,children:"Previous"})]})]})})}),o.jsx(L.Z,{visible:k,imageUrl:O,onClose:()=>P(!1)}),(0,o.jsxs)(f(),{title:"Preview",centered:!0,visible:h,onOk:()=>d(!1),onCancel:()=>d(!1),width:720,footer:null,children:[o.jsx("h1",{style:{fontSize:"1.2rem",lineHeight:"1.6"},children:H}),o.jsx("div",{dangerouslySetInnerHTML:{__html:a},style:{fontSize:"1.2rem",lineHeight:"1.6"}})]}),o.jsx(f(),{visible:C.showMediaModal,title:"Media",onOk:()=>w({...C,showMediaModal:!1}),onCancel:()=>w({...C,showMediaModal:!1}),width:720,footer:null,children:o.jsx(q.Z,{style:{fontSize:"1.2rem",lineHeight:"1.6"}})})]})};a()}catch(e){a(e)}})}};