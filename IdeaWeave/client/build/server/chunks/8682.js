"use strict";exports.id=8682,exports.ids=[8682],exports.modules={8682:(e,t,o)=>{o.a(e,async(e,l)=>{try{o.d(t,{Z:()=>X});var s=o(997),r=o(6689);o(1791);var i=o(9648),a=o(5417),n=o.n(a),c=o(3526),d=o.n(c),p=o(7050),h=o.n(p),m=o(8518),u=o.n(m),x=o(675),g=o.n(x),y=o(3800),v=o.n(y),j=o(6418),f=o.n(j),S=o(2317),C=o.n(S),$=o(8633),w=o.n($),b=o(6216),k=o.n(b),I=o(3166),N=o.n(I),M=o(5152),P=o.n(M),q=o(6201),z=o(1163),O=o(2540),B=o.n(O),T=o(1796),E=o.n(T),J=o(2981),_=o.n(J),A=o(3911),L=o.n(A);o(3789);var V=o(148),R=o(4212),H=o(8214),D=e([i,q,V]);[i,q,V]=D.then?(await D)():D;let U=P()(()=>Promise.resolve().then(o.t.bind(o,305,23)),{loadableGenerated:{modules:["..\\components\\posts\\EditPostComponent.js -> react-quill"]},ssr:!1,loading:()=>s.jsx("p",{children:"Loading ..."})}),{Content:Z}=n(),{Option:G}=d(),{Panel:W}=w(),{TabPane:Y}=k(),F={toolbar:[[{font:[]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],["blockquote","code-block"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["clean"]]},K=["font","size","bold","italic","underline","strike","blockquote","list","bullet","indent","script","color","background"],Q={height:"500px",overflowY:"auto",padding:"20px"},X=function({page:e="admin"}){let[t,o]=(0,r.useState)({}),[l,a]=(0,r.useState)(""),[n,c]=(0,r.useState)([]),[p,m]=(0,r.useState)(""),[x,y]=(0,r.useState)({}),[j,S]=(0,r.useState)(!1),[$,b]=(0,r.useState)(!0),I=(0,z.useRouter)(),[M,P]=(0,r.useContext)(R.Y),[O,T]=(0,r.useState)(0),{Step:J}=N(),[A,D]=(0,r.useState)([]),[Z,X]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(""),[eo,el]=(0,r.useState)([]),[es,er]=(0,r.useState)([]);(0,r.useEffect)(()=>{ei(),ea()},[]),(0,r.useEffect)(()=>{ea()},[I?.query?.slug]);let ei=async()=>{try{let{data:e}=await i.default.get("/category");c(e)}catch(e){console.log(e)}},ea=async()=>{try{let{data:e}=await i.default.get(`/post/${I.query.slug}`);a(e.post.title),o(e.post.content),y(e.post.coverImage),m(e.post._id);let t=e.post.volumes.map(e=>({volume:e.volume,chapters:e.chapters.map(e=>({name:e.name||`Chapter ${chapterIndex+1}`,content:e.content}))}));D(t);let l=[];e.post.categories.map(e=>l.push(e.name)),el(l),b(!1)}catch(e){console.log(e),b(!1)}},en=async()=>{try{b(!0);let o=A.filter(e=>e.volume&&e.chapters.length>=1).map((e,o)=>`${e.volume}: ${e.chapters.map((e,l)=>`Chapter ${e.chapter||"1"}: ${e.name} - ${t[`${o}-${l}`]?.content||ec(o,l)||""}`).join(", ")}`).join("; "),s=`<div style="font-size: 1.2rem; line-height: 1.6">${o}</div>`,r=eo.length>0?eo:es,a={title:l,content:s,categories:r,coverImage:M?.selected?._id?M?.selected?._id:x?._id?x._id:void 0,volumes:A.map((e,o)=>({volume:e.volume,chapters:e.chapters.map((e,l)=>{let s=`${o}-${l}`,r=t[s];return{chapter:e.chapter||"1",name:e.name||"Untitled",content:r?.content!==void 0?r.content:e.content}})}))},{data:n}=await i.default.put(`/edit-post/${p}`,a);n?.error?(q.toast.error(n?.error),b(!1)):(localStorage.removeItem("post-edit-title"),localStorage.removeItem("post-edit-volumes"),Object.keys(t).forEach(e=>{let t=`post-edit-chapter-${e}`;localStorage.removeItem(t)}),localStorage.removeItem("post-edit-image"),P({...M,selected:null}),I.push(`/${e}/posts`),q.toast.success("Post updated successfully"))}catch(e){console.error(e),q.toast.error("Post update failed. Try again."),b(!1)}},ec=(e,t)=>{let o=`${e}-${t}`,l=`post-edit-chapter-${o}`,s=JSON.parse(localStorage.getItem(l));return s?.content||""},ed=()=>{if(0===O)localStorage.setItem("post-edit-title",JSON.stringify(l));else if(1===O){let e=JSON.parse(localStorage.getItem("post-edit-volumes"))||[],t=JSON.parse(localStorage.getItem("post-edit-image"))||{},o=A.some((t,o)=>{let l=e[o]||{};return t.volume!==l.volume||t.chapters.some((e,t)=>{let o=l.chapters?.[t]||{};return e.name!==o.name||e.content!==o.content})});if(o){let e=A.map(e=>({volume:e.volume,chapters:e.chapters.map(e=>({chapter:e.chapter||"1",name:e.name||"Untitled",content:e.content||""}))}));localStorage.setItem("post-edit-volumes",JSON.stringify(e)),localStorage.setItem("post-edit-image",JSON.stringify(M?.selected))}else localStorage.setItem("post-edit-volumes",JSON.stringify(e)),localStorage.setItem("post-edit-image",JSON.stringify(t))}T(O+1)},ep=()=>{T(O-1)},eh=(e,t)=>{let l=[...A];l[e].chapters.splice(t,1),l[e].chapters.forEach((e,t)=>{e.chapter=t+1,e.name=`Chapter ${e.chapter}`});let s=`${e}-${t}`,r=`post-edit-chapter-${s}`;localStorage.removeItem(r),D(l),o(e=>{let{[s]:t,...o}=e;return o})},em=e=>{let t=[...A],l=t.splice(e,1)[0],s=`volume-${e}`;localStorage.removeItem(s),l.chapters.forEach((t,o)=>{let l=`${e}-${o}`,s=`post-edit-chapter-${l}`;localStorage.removeItem(s)}),D(t),o(t=>{let o=Object.keys(t).filter(t=>t.startsWith(`${e}-`)),{[s]:l,...r}=t;return o.reduce((e,o)=>{let l=`post-edit-chapter-${o}`;return localStorage.removeItem(l),{...e,[o]:t[o]}},r)})};return(0,s.jsxs)(s.Fragment,{children:[s.jsx(h(),{justify:"center",style:{paddingLeft:50,paddingTop:"50px",paddingRight:50},children:s.jsx(u(),{span:18,children:(0,s.jsxs)(C(),{style:{padding:"20px",marginBottom:"20px"},children:[(0,s.jsxs)(N(),{current:O,style:{marginBottom:"20px"},children:[s.jsx(J,{title:"Book Info"}),s.jsx(J,{title:"Volumes and Chapters"}),s.jsx(J,{title:"Review and Publish"})]}),0===O&&(0,s.jsxs)(C(),{children:[s.jsx("h1",{children:"Create a new Book"}),s.jsx(g(),{value:l,size:"large",placeholder:"Give your post a title",onChange:e=>{a(e.target.value)}}),s.jsx("br",{}),s.jsx("br",{}),(0,s.jsxs)(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},onClick:()=>P({...M,showMediaModal:!0}),children:[s.jsx(B(),{})," Cover Image"]}),M?.selected?(0,s.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[s.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:M?.selected?.url,alt:"Image"}),s.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,s.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[s.jsx(E(),{style:{fontSize:"25px",color:"white"}}),s.jsx("br",{}),"Click to Preview"]})})]}):x?.url?(0,s.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[s.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:x?.url,alt:"Image"}),s.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,s.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[s.jsx(E(),{style:{fontSize:"25px",color:"white"}}),s.jsx("br",{}),"Click to Preview"]})})]}):"",s.jsx("br",{}),s.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:ed,children:"Next"})]}),1===O&&(0,s.jsxs)(C(),{style:{marginBottom:"20px"},children:[s.jsx("h1",{children:"Volumes and Chapters"}),s.jsx(w(),{accordion:!0,children:A.map((e,l)=>(0,s.jsxs)(W,{header:`Volume ${l+1}`,children:[s.jsx(g(),{value:e.volume,size:"large",placeholder:`Volume ${l+1}`,onChange:e=>{let t=[...A];t[l].volume=e.target.value,D(t)}}),s.jsx("div",{style:{marginBottom:"10px"}}),s.jsx(k(),{tabPosition:"left",children:e.chapters.map((e,r)=>(0,s.jsxs)(Y,{tab:`Chapter ${r+1}`,children:[(0,s.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,s.jsxs)(v(),{style:{marginRight:"8px"},type:"danger",onClick:()=>eh(l,r),children:["Remove Chapter ",r+1]}),s.jsx("span",{children:`Chapter ${r+1}: ${e.name}`})]}),s.jsx(g(),{value:e.name,placeholder:`Chapter ${r+1} Name`,onChange:e=>{let t=[...A];t[l].chapters[r].name=e.target.value,D(t)}}),s.jsx("div",{style:Q,children:s.jsx(U,{modules:F,formats:K,placeholder:"Compose here...",value:e.content,onChange:(s,i,a,n)=>{let c=[...A];c[l].chapters[r].content=s,D(c);let d=`${l}-${r}`;o({...t,[d]:{content:s,name:`Chapter ${r+1}: ${e.name}`}});let p=`post-edit-chapter-${d}`;localStorage.setItem(p,JSON.stringify({content:s,name:`Chapter ${r+1}: ${e.name}`}))},theme:"snow",style:{height:"400px",marginTop:"10px"}})})]},`chapter-${l}-${r}`))}),s.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:s.jsx(_(),{}),onClick:()=>{let e=[...A],t=e[l].chapters.length-1,o=t>=0?Math.max(...e[l].chapters.map(e=>e.chapter))+1:1;e[l].chapters.push({name:`Chapter ${o}`,chapter:o,content:""}),D(e)},children:"Add Chapter"}),(0,s.jsxs)(v(),{style:{margin:"10px 0px 20px",width:"100%"},onClick:()=>em(l),children:["Remove Volume ",l+1]})]},`volume-${l}`))}),s.jsx(v(),{style:{margin:"10px 0px 20px",width:"100%"},type:"dashed",icon:s.jsx(_(),{}),onClick:()=>{D([...A,{volume:"",chapters:[{chapter:"",content:""}]}])},children:"Add Volume"}),(0,s.jsxs)(h(),{justify:"space-between",style:{marginTop:"20px"},children:[s.jsx(u(),{children:s.jsx(v(),{type:"primary",onClick:ep,children:"Previous"})}),s.jsx(u(),{children:s.jsx(v(),{type:"primary",onClick:ed,children:"Next"})})]})]}),2===O&&(0,s.jsxs)(C(),{style:{maxWidth:"800px",margin:"auto",marginTop:"20px"},children:[s.jsx("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Review and Publish"}),M?.selected?(0,s.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[s.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:M?.selected?.url,alt:"Image"}),s.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,s.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[s.jsx(E(),{style:{fontSize:"25px",color:"white"}}),s.jsx("br",{}),"Click to Preview"]})})]}):x?.url?(0,s.jsxs)("div",{style:{marginTop:"15px",position:"relative",cursor:"pointer",overflow:"hidden",transition:"transform 0.3s"},className:"image-container",onMouseEnter:()=>{let e=document.querySelector(".overlay");e.style.opacity=1},onMouseLeave:()=>{let e=document.querySelector(".overlay");e.style.opacity=0},onClick:()=>{M?.selected&&(et(M?.selected?.url),X(!0))},children:[s.jsx("img",{style:{width:"100%",transition:"transform 0.3s"},src:x?.url,alt:"Image"}),s.jsx("div",{className:"overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",color:"white",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",opacity:0,transition:"opacity 0.3s"},children:(0,s.jsxs)("div",{className:"overlay-content",style:{textAlign:"center"},children:[s.jsx(E(),{style:{fontSize:"25px",color:"white"}}),s.jsx("br",{}),"Click to Preview"]})})]}):"",s.jsx("h2",{children:"Book Title:"}),s.jsx("p",{children:l}),s.jsx("h2",{children:"Volumes and Chapters:"}),s.jsx(k(),{defaultActiveKey:"0",type:"card",style:{marginBottom:"20px"},children:A.map((e,o)=>s.jsx(Y,{tab:`Volume ${o+1}: ${e.volume}`,children:s.jsx(k(),{type:"card",children:e.chapters.map((e,l)=>{let r=`${o}-${l}`,i=t[r]?.content||"",a=e.content||"";return s.jsx(Y,{tab:`Chapter ${l+1}: ${e.name}`,children:s.jsx("div",{dangerouslySetInnerHTML:{__html:a!==i?a:i},style:{fontSize:"1.2rem",lineHeight:"1.6",padding:"20px"}})},r)})})},o.toString()))}),s.jsx("h2",{children:"Categories:"}),s.jsx("h4",{children:"Select categories for your post:"}),s.jsx(d(),{mode:"multiple",allowClear:!0,placeholder:"Select categories",style:{width:"100%"},value:eo,onChange:e=>el(e),children:n.map(e=>s.jsx(G,{children:e.name},e.name))}),s.jsx("div",{style:{marginBottom:"10px"}}),s.jsx(v(),{style:{width:"100%",marginBottom:"10px"},type:"primary",loading:$,icon:s.jsx(L(),{}),onClick:()=>{if(0===eo.length){q.toast.error("Please choose at least one category before publishing.");return}en()},children:"Publish"}),s.jsx(v(),{style:{margin:"10px 0px 10px 0px",width:"100%"},type:"primary",onClick:ep,children:"Previous"})]})]})})}),s.jsx(H.Z,{visible:Z,imageUrl:ee,onClose:()=>X(!1)}),(0,s.jsxs)(f(),{title:"Preview",centered:!0,visible:j,onOk:()=>S(!1),onCancel:()=>S(!1),width:720,footer:null,children:[s.jsx("h1",{style:{fontSize:"1.2rem",lineHeight:"1.6"},children:l}),s.jsx("div",{dangerouslySetInnerHTML:{__html:t},style:{fontSize:"1.2rem",lineHeight:"1.6"}})]}),s.jsx(f(),{visible:M.showMediaModal,title:"Media",onOk:()=>P({...M,showMediaModal:!1}),onCancel:()=>P({...M,showMediaModal:!1}),width:720,footer:null,children:s.jsx(V.Z,{style:{fontSize:"1.2rem",lineHeight:"1.6"}})})]})};l()}catch(e){l(e)}})}};